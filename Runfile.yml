tasks:
  build:watch:
    watch:
      extensions:
        - .go
        - .tpl
    env:
      CGO_ENABLED: 0
    cmd:
      - run build version="$(echo \"dev built at $(date '+%X on %b %d, %4Y')\")"

  build:
    env:
      binpath:
        default: 
          sh: "echo ./bin/nixy"
      GOOS:
        default:
          sh: go env GOOS
      GOARCH:
        default:
          sh: go env GOARCH
      version:
        required: true
    cmd:
      - go build -v -o $binpath-$GOOS-$GOARCH -ldflags="-s -w -X 'main.Version=$version'" -tags urfave_cli_no_docs ./cmd/
      - echo "Build Successful âœ…"

  build:all:
    parallel: true
    env:
      version:
        required: true
    cmd:
      - run: build
        env:
          GOOS: linux
          GOARCH: amd64
      - run: build
        env:
          GOOS: linux
          GOARCH: arm64
      - run: build
        env:
          GOOS: darwin
          GOARCH: amd64
      - run: build
        env:
          GOOS: darwin
          GOARCH: arm64
