tasks:
  build:watch:
    watch:
      extensions:
        - .go
        - .nix.tpl
    env:
      CGO_ENABLED: 0
    cmd:
      - go build -o ./bin/nixy ./cmd/main.go
      - echo "Build Successful âœ…"

  build:
    env:
      binpath:
        default: 
          sh: "echo ./bin/nixy"
      GOOS:
        default:
          sh: go env GOOS
      GOARCH:
        default:
          sh: go env GOARCH
    cmd:
      - go build -v -o $binpath-$GOOS-$GOARCH -ldflags="-s -w" -tags urfave_cli_no_docs ./cmd/

  build:all:
    parallel: true
    # env:
    #   GOMODCACHE: "/tmp/y/modcache"
    #   GOCACHE: "/tmp/y/gocache"
    cmd:
      - run: build
        env:
          GOOS: linux
          GOARCH: amd64
      - run: build
        env:
          GOOS: linux
          GOARCH: arm64
      - run: build
        env:
          GOOS: darwin
          GOARCH: amd64
      - run: build
        env:
          GOOS: darwin
          GOARCH: arm64
